# é¡¹ç›®ä»‹ç»
ä»…éœ€ä¸€æ¬¡è®¤è¯ï¼Œå³å¯è®¿é—®æ‰€æœ‰æˆæƒè®¿é—®çš„åº”ç”¨ç³»ç»Ÿï¼Œå¯ä»¥ä¸ºä¼ä¸šäººå‘˜æä¾›ä¾¿æ·ã€é«˜æ•ˆçš„è®¿é—®ä½“éªŒã€‚
## æ¶æ„è®¾è®¡
é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„è®¾è®¡ï¼Œé¡¹ç›®åœ°å€å¦‚ä¸‹ï¼š
| é¡¹ç›®   | é¡¹ç›®åœ°å€ |
|:------|:-----|
| å‰ç«¯   | https://github.com/yuyan075500/ops-web    |                                                                                                              |
| åç«¯   | https://github.com/yuyan075500/ops-api    |
## åç«¯ç›®å½•è¯´æ˜
* configï¼šå…¨å±€é…ç½®ã€‚
* controllerï¼šè·¯ç”±è§„åˆ™é…ç½®å’Œæ¥å£çš„å…¥å‚ä¸å“åº”ã€‚
* serviceï¼šæ¥å£çš„å¤„ç†é€»è¾‘ã€‚
* daoï¼šæ•°æ®åº“æ“ä½œã€‚
* modelï¼šæ•°æ®åº“æ¨¡å‹å®šä¹‰ã€‚
* dbï¼šæ•°æ®åº“ã€ç¼“å­˜ç­‰å®¢æˆ·ç«¯åˆå§‹åŒ–ã€‚
* middlewareï¼šä¸­é—´ä»¶å±‚ï¼Œä½œç”¨äºå…¨å±€ï¼Œå¦‚è·¨åŸŸã€JWTè®¤è¯ã€æƒé™æ ¡éªŒç­‰ã€‚
* utilsï¼šå·¥å…·å±‚ï¼Œå¦‚Tokenè§£æï¼Œæ–‡ä»¶æ“ä½œç­‰ã€‚
## åç«¯CodeçŠ¶æ€ç è¯´æ˜
* 0ï¼šè¯·æ±‚æˆåŠŸã€‚
* 90400ï¼šè¯·æ±‚å‚æ•°é”™è¯¯ã€‚
* 90401ï¼šè®¤è¯å¤±è´¥ã€‚
* 90403ï¼šæ‹’ç»è®¿é—®ã€‚
* 90404ï¼šè®¿é—®çš„å¯¹è±¡æˆ–èµ„æºä¸å­˜åœ¨ã€‚
* 90500ï¼šå…¶å®ƒé”™è¯¯ã€‚
* 90514ï¼šTokenè¿‡æœŸæˆ–æ— æ•ˆã€‚
# åŠŸèƒ½æ¦‚è§ˆ
## è®¤è¯ç›¸å…³
* **SSOå•ç‚¹ç™»å½•**ï¼šæ”¯æŒ`CAS 3.0`ã€`OAuth 2.0`å’Œ`SAML2`åè®®ï¼Œå¯ä»¥å‚è€ƒ [å®¢æˆ·ç«¯é…ç½®æŒ‡å—](https://github.com/yuyan075500/ops-api/blob/main/deploy/sso.md "é…ç½®æŒ‡å—") å’Œ [å·²æµ‹è¯•å®¢æˆ·ç«¯åˆ—è¡¨](https://github.com/yuyan075500/ops-api/blob/main/deploy/sso.md#%E5%B7%B2%E6%B5%8B%E8%AF%95%E9%80%9A%E8%BF%87%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF "å®¢æˆ·ç«¯åˆ—è¡¨")ã€‚
* **ç”¨æˆ·è®¤è¯**ï¼šåŒæ—¶æ”¯æŒ [é’‰é’‰æ‰«ç ç™»å½•](https://github.com/yuyan075500/ops-api/blob/main/deploy/dingtalk.md "æ‰«ç é…ç½®")ã€[ä¼ä¸šå¾®ä¿¡æ‰«ç ç™»å½•](https://github.com/yuyan075500/ops-api/blob/main/deploy/wechat.md "ä¼ä¸šå¾®ä¿¡é…ç½®")ã€[é£ä¹¦æ‰«ç ç™»å½•](https://github.com/yuyan075500/ops-api/blob/main/deploy/feishu.md "é£ä¹¦æ‰«ç é…ç½®")ã€[OpenLDAPè®¤è¯ã€Windows ADè®¤è¯](https://github.com/yuyan075500/ops-api/blob/main/deploy/deploy.md#ldap%E9%85%8D%E7%BD%AE "LDAPé…ç½®")å’Œæœ¬åœ°è´¦å·è®¤è¯ã€‚
* **åŒå› ç´ **ï¼šæ”¯æŒä½¿ç”¨Google Authenticatorã€é˜¿é‡Œäº‘APPå’Œåä¸ºäº‘APPæ‰«æè·å–åŠ¨æ€éªŒè¯ç ã€‚

    <br>
    <img src="deploy/sso_example/img/login-1.gif" alt="img" width="350" height="200"/>
    <img src="deploy/sso_example/img/login-mfa.gif" alt="img" width="350" height="200"/>
    <br>

### ç”¨æˆ·ç™»å½•ç­–ç•¥
âœ…æ”¯æŒï¼ŒğŸŸ¡æ•¬è¯·æœŸå¾…ï¼ŒâŒä¸æ”¯æŒ

| ç”¨æˆ·æ¥æº       | ç”¨æˆ·ç™»å½• | è´¦å·åŒæ­¥ | ç”¨æˆ·å¯†ç ä¿®æ”¹ | ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹ï¼ˆç”µè¯ã€é‚®ç®±ï¼‰ | åŒå› ç´ è®¤è¯ | å•ç‚¹ç™»å½• | [NGINXé‰´æƒ](https://github.com/yuyan075500/ops-api/blob/main/deploy/sso.md#nginx%E4%BB%A3%E7%90%86%E9%89%B4%E6%9D%83 "NGINXé‰´æƒ") |
|:-----------|:-----|:-----|:-------|:--------------|:------|:-----|:------------------------------------------------------------------------------------------------------------------------------|
| æœ¬åœ°         | âœ…    | âœ…    | âœ…      | âœ…             | âœ…     | âœ…    | âœ…                                                                                                                             |
| Windows AD | âœ…    | âœ…    | âœ…      | ğŸŸ¡            | âœ…     | âœ…    | âœ…                                                                                                                             |
| OpenLDAP   | âœ…    | âœ…    | âœ…      | ğŸŸ¡            | âœ…     | âœ…    | âœ…                                                                                                                             |
| é’‰é’‰         | âœ…    | âŒ    | âŒ      | âŒ             | âŒ     | âœ…    | ğŸŸ¡                                                                                                                            | 
| ä¼ä¸šå¾®ä¿¡       | âœ…    | âŒ    | âŒ      | âŒ             | âŒ     | âœ…    | ğŸŸ¡                                                                                                                            | 
| é£ä¹¦         | âœ…    | âŒ    | âŒ      | âŒ             | âŒ     | âœ…    | ğŸŸ¡                                                                                                                            | 
### è´¦å·åŒæ­¥è§„åˆ™
æ— è®ºä½¿ç”¨å“ªä¸€ç§ç”¨æˆ·è®¤è¯æ–¹å¼ï¼Œéƒ½éœ€è¦ç¡®ä¿æœ¬åœ°ç³»ç»Ÿä¸­ç”¨æˆ·å­˜åœ¨ï¼Œæ‰€ä»¥å½“é…ç½®å¥½Windows ADæˆ–OpenLDAPåï¼Œéœ€è¦ç™»å½•å¹³å°ç‚¹å‡»ã€ç”¨æˆ·ç®¡ç†ã€‘-ã€åˆ†ç»„ç®¡ç†ã€‘-ã€LDAPè´¦å·åŒæ­¥ã€‘æ‰§è¡Œä¸€æ¬¡ç”¨æˆ·åŒæ­¥ï¼Œç”¨æˆ·çš„åŒæ­¥è§„åˆ™å¦‚ä¸‹ï¼š
1. å¦‚æœæœ¬åœ°ç³»ç»Ÿä¸­æ²¡æœ‰ï¼ŒLDAPä¸­æœ‰ï¼Œåˆ™åˆ›å»ºã€‚
2. å¦‚æœæœ¬åœ°ç³»ç»Ÿæœ‰ï¼ŒLDAPä¸­æœ‰ï¼Œåˆ™æ›´æ–°ï¼ˆä»…æ›´æ–°ç”¨æˆ·æ¥æºä¸ºLDAPä¸”`username`ç›¸åŒï¼Œæ›´æ–°æ‰‹æœºå·å’Œé‚®ç®±å­—æ®µï¼‰ã€‚

åŒæ­¥ç”¨æˆ·æ—¶ï¼Œç”¨æˆ·å­—æ®µæ˜ å°„è§„åˆ™å¦‚ä¸‹ï¼š
```shell
# OpenLDAP
{
	"name": "uid",
	"username": "cn",
	"email": "mail",
	"phone_number": "telephoneNumber"
}

# Windows AD
{
	"name": "sAMAccountName",
	"username": "cn",
	"email": "mail",
	"phone_number": "telephoneNumber",
	"is_active": "userAccountControl"
}
```
## å…¶å®ƒ
* æ”¯æŒSwaggeræ¥å£æ–‡æ¡£ï¼šè®¿é—®åœ°å€ï¼š`/swagger/index.html`ã€‚
* æ”¯æŒç”¨æˆ·å¯†ç è‡ªåŠ©æ›´æ”¹ï¼šè®¿é—®åœ°å€ï¼š`/reset_password`ã€‚
* ä¼ä¸šç½‘ç«™å¯¼èˆªï¼šè®¿é—®åœ°å€ï¼š`/sites`ã€‚
# é¡¹ç›®éƒ¨ç½²
å‚è€ƒ [Docker Composeéƒ¨ç½²](https://github.com/yuyan075500/ops-api/blob/main/deploy/deploy.md#docker-compose%E9%83%A8%E7%BD%B2 "docker-composeéƒ¨ç½²") å’Œ [Kuberneteséƒ¨ç½²](https://github.com/yuyan075500/ops-api/blob/main/deploy/deploy.md#kubernetes%E9%83%A8%E7%BD%B2 "Kuberneteséƒ¨ç½²")ã€‚
# é¡¹ç›®äº¤æµ
å¦‚æœä½ å¯¹æ­¤é¡¹ç›®æ„Ÿå…´è¶£ï¼Œæ¬¢è¿æ‰«æä¸‹æ–¹äºŒç»´ç åŠ å…¥å¾®ä¿¡äº¤æµç¾¤ã€‚  
<br>
<img src="deploy/sso_example/img/wechat.jpg" alt="img" width="200" height="200"/>
## ä½œè€…è”ç³»æ–¹å¼
WeChatï¼š270142877ã€‚  
Emailï¼š270142877@qq.comã€‚  
<br>
è”ç³»æ—¶è¯·æ³¨åæ¥æ„ã€‚